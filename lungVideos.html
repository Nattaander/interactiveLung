<!DOCTYPE html>
<html lang="en">
<head>
<meta charset=utf-8>
<meta name="viewport" content="width=620">
<link rel="stylesheet" href="style/lungVidStyle.css">
</head>
<body onLoad="swap(one); changeBtn(btn1); readyCheck();"> <!-- swap() needs to happen straight away due to issues with opacity switching -->

<!-- ======================Video/Heading wrapper====================== -->
<section id="wrapper1">
    <header>
      <h1>CFUI - Interactive Visualiser for Cystic Fibrosis</h1>
    </header>
<!-- ===========================Lung videos=========================== -->
  <article>
    <video preload="auto" id="one" class='lungVideos' loop>
      <source src="media/normal.mp4" />
    </video>    
    <video preload="auto" id="two"  class='lungVideos' loop>
      <source src="media/CFLung.mp4" />
    </video>
    <video preload="auto" id="three" class='lungVideos' loop>
      <source src="media/exacerbate.mp4" />
    </video>
  </article>
  <!-- =========================== buttons =========================== -->
<div id='btnDiv'>
  <table>
    <tr>
        <td>
  <button onclick="swap(one); changeBtn(btn1);" id='nBtn'>Normal Lung</button>
        </td>
    </tr>
    <tr>
        <td>
  <button onclick="swap(two); changeBtn(btn2);" id='cfBtn'>CF Lung</button>
        </td>
   </tr>
    <tr>
        <td>
  <button onclick="swap(three); changeBtn(btn3);" id='exBtn'>Exacerbated Lung</button>
        </td>
    </tr>
    <tr>
        <td>
  <button onclick="mute();" id='mtBtn'><img src="media/unmute.png" /></button>
        </td>
    </tr>
  </table>
</div>
<!-- ===========================pipe videos=========================== -->
  <article>
    <video style="border: 5px solid white;" preload="auto" id="pipeone" class='pipeVideos' loop>
      <source src="media/nBreathBGAudio.mp4" />
    </video>    
    <video style="border: 5px solid white;" preload="auto" id="pipetwo"  class='pipeVideos' loop muted>
      <source src="media/cfBreathBGAudio.mp4" />
    </video>
      <video style="border: 5px solid white;" preload="auto" id="pipethree" class='pipeVideos' loop muted>
      <source src="media/exBreathBGAudio.mp4" />
    </video>
  </article>
</section>




<script>
//################################
//variables
var video = document.querySelector('#one'),
    video2 = document.querySelector('#two'),
    video3 = document.querySelector('#three'),
    video4 = document.querySelector('#pipeone'),
    video5 = document.querySelector('#pipetwo'),
    video6 = document.querySelector('#pipethree'),
    btn1 = document.querySelector('#nBtn'),
    btn2 = document.querySelector('#cfBtn'),
    btn3 = document.querySelector('#exBtn'),
    btnMute = document.querySelector('#mtBtn'),
    isMuted = false;

//################################
//button selected function
function changeBtn(selectBtn){
  btn1.style.backgroundColor = '#33B3B3';
  btn2.style.backgroundColor = '#33B3B3';
  btn3.style.backgroundColor = '#33B3B3';
  selectBtn.style.backgroundColor = '#55D5D5';

}

function mute() {
  if (isMuted == false) {
    isMuted = true;
    btnMute.innerHTML = '<img src="media/mute.png" />';
    document.getElementById('pipeone').muted=true;
    document.getElementById('pipetwo').muted=true;
    document.getElementById('pipethree').muted=true;
  }
  else if (isMuted == true) {
    if (document.getElementById('pipeone').style.opacity == 1) {
      document.getElementById('pipeone').muted = false;
    }
    else if (document.getElementById('pipetwo').style.opacity == 1) {
      document.getElementById('pipetwo').muted = false;
    }
    else if (document.getElementById('pipethree').style.opacity == 1) {
      document.getElementById('pipethree').muted = false;
    }
    isMuted = false;
    btnMute.innerHTML = '<img src="media/unmute.png" />';
  }
}

//################################
//swap between videos
function swap(vid) {

  switch(vid){
    case one:
        document.getElementById('one').style.opacity = 1;
        document.getElementById('two').style.opacity = 0;
        document.getElementById('three').style.opacity = 0;
        document.getElementById('pipeone').style.opacity = 1;
        if(isMuted == false){
          document.getElementById('pipeone').muted=false;
        }
        document.getElementById('pipetwo').style.opacity = 0;
        document.getElementById('pipetwo').muted=true;
        document.getElementById('pipethree').style.opacity = 0;
        document.getElementById('pipethree').muted=true;
        break;

    case two:
        document.getElementById('one').style.opacity = 0;
        document.getElementById('two').style.opacity = 1;
        document.getElementById('three').style.opacity = 0;
        document.getElementById('pipeone').style.opacity = 0;
        document.getElementById('pipeone').muted=true;
        document.getElementById('pipetwo').style.opacity = 1;
        if(isMuted == false){
          document.getElementById('pipetwo').muted=false;
        }
        document.getElementById('pipethree').style.opacity = 0;
        document.getElementById('pipethree').muted=true;
        break;

    case three:
        document.getElementById('one').style.opacity = 0;
        document.getElementById('two').style.opacity = 0;
        document.getElementById('three').style.opacity = 1;
        document.getElementById('pipeone').style.opacity = 0;
        document.getElementById('pipeone').muted=true;
        document.getElementById('pipetwo').style.opacity = 0;
        document.getElementById('pipetwo').muted=true;
        document.getElementById('pipethree').style.opacity = 1;
        if(isMuted == false){
          document.getElementById('pipethree').muted=false;
        }
  }
}  
//################################
//check the ready state of videos

function updateTime(){
  //set the time of videos 2-6 to be the same as 1
    video.currentTime = 0;
    video2.currentTime = video.currentTime;
    video3.currentTime = video.currentTime;
    video4.currentTime = video.currentTime;
    video5.currentTime = video.currentTime;
    video6.currentTime = video.currentTime;
}

function readyCheck(){
  //if ((video3.readyState === 4) && (video.readyState === 4)&& (video2.readyState === 4) && (video4.readyState === 4) && (video5.readyState === 4)&& (video6.readyState === 4)) {
    video.play();
    video2.play();
    video3.play();
    video4.play();
    video5.play();
    video6.play();

    //this is to avoid the issue of the first breath in all videos being off sink on the first load
    video.currentTime = 0;
    video2.currentTime = video.currentTime;
    video3.currentTime = video.currentTime;
    video4.currentTime = video.currentTime;
    video5.currentTime = video.currentTime;
    video6.currentTime = video.currentTime;
  //}
}

//every 2 seconds call function
  var lungTimer = setInterval(updateTime, 2400);


//################################
</script>


</body>
</html>